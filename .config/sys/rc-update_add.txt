#!/bin/sh
set -xve

# Fix greetd user:

adduser greetd seat

# Fix sway:

adduser yc seat

# for libinput

setup-devd udev

# set up services
rc-update add zram-init boot
rc-update add consolefont boot
rc-update add seatd boot
rc-update add elogind
rc-update add greetd
rc-update add brightnessctl
rc-update add tlp
rc-update add i2pd
rc-update add yggdrasil
rc-update add dnscrypt-proxy
rc-update add alsa
rc-update add tor
rc-update add hwclock

# firewall

# must run ufw enable first

ufw enable

# then add ufw service
rc-update add ufw

# timezone

setup-timezone Europe/Berlin

# if at home
# setup-timezone Asia/Shanghai

# Restore system configs:

mkdir -p /etc/elogind/logind.conf.d
mkdir -p /etc/firefox/policies
mkdir -p /etc/elogind/system-sleep/
su yc -c "git  -C /home/yc/.config/sys/etc ls-files -z" | xargs -0I{} cp /home/yc/.config/sys/etc/{} /etc/{}

# Remove temporary doas conf: has conflict with the real deal

rm /etc/doas.d/permit-wheel.conf

# install info files into dir file
# https://www.gnu.org/software/texinfo/manual/texinfo/html_node/Directory-File.html
find /usr/share/info/ -name '*.info*' -print0 | xargs -0I{} install-info {} /usr/share/info/dir

# add yc to abuild group
adduser yc abuild

# abuild permissions
mkdir -p /var/cache/distfiles
chgrp abuild /var/cache/distfiles
chmod g+w /var/cache/distfiles
